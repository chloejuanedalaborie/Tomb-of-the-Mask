import pyxel

# Configurations
TAILLE_GRILLE = 16
TAILLE_CASE = 8
VITESSE = 2

pyxel.init(TAILLE_GRILLE * TAILLE_CASE, TAILLE_GRILLE * TAILLE_CASE, title="Labyrinthe AutoMove", fps=1000)

# 0 = vide, 1 = mur, 2 = objectif
labyrinthe = [
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
    [1,0,0,0,0,1,0,0,0,0,0,1,0,0,2,1],
    [1,0,1,1,0,1,0,1,1,1,0,1,0,1,1,1],
    [1,0,1,0,0,0,0,1,0,0,0,1,0,0,0,1],
    [1,0,1,0,1,1,1,1,0,1,1,1,1,1,0,1],
    [1,0,0,0,1,0,0,0,0,0,0,0,0,1,0,1],
    [1,1,1,0,1,0,1,1,1,1,1,1,0,1,0,1],
    [1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,1],
    [1,0,1,1,1,1,1,0,1,1,0,1,1,1,0,1],
    [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1],
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
]

# Snake
snake = {
    "direction": (0, 0),
    "en_mouvement": False,
    "position_case": [1, 1],
    "position_pixel": [1 * TAILLE_CASE, 1 * TAILLE_CASE],
    "cible": [1, 1],
    "animation_step": 0
}

def case_est_libre(x, y):
    return 0 <= x < TAILLE_GRILLE and 0 <= y < len(labyrinthe) and labyrinthe[y][x] != 1

def case_est_cible(x, y):
    return labyrinthe[y][x] == 2

def update():
    if not snake["en_mouvement"]:
        if pyxel.btnp(pyxel.KEY_LEFT):
            snake["direction"] = (-1, 0)
        elif pyxel.btnp(pyxel.KEY_RIGHT):
            snake["direction"] = (1, 0)
        elif pyxel.btnp(pyxel.KEY_UP):
            snake["direction"] = (0, -1)
        elif pyxel.btnp(pyxel.KEY_DOWN):
            snake["direction"] = (0, 1)
        else:
            return

        # Avancer jusqu'au prochain mur ou case cible
        x, y = snake["position_case"]
        dx, dy = snake["direction"]

        while True:
            nx, ny = x + dx, y + dy
            if case_est_libre(nx, ny):
                x, y = nx, ny
                if case_est_cible(x, y):
                    break  # s'arrête dès qu'on atteint la cible
            else:
                break

        snake["cible"] = [x, y]
        snake["en_mouvement"] = True
        snake["animation_step"] = 0

    else:
        dx = snake["direction"][0] * VITESSE
        dy = snake["direction"][1] * VITESSE
        snake["position_pixel"][0] += dx
        snake["position_pixel"][1] += dy
        snake["animation_step"] += abs(dx + dy)

        cx, cy = snake["cible"]
        cible_px = [cx * TAILLE_CASE, cy * TAILLE_CASE]

        if snake["position_pixel"] == cible_px:
            snake["en_mouvement"] = False
            snake["position_case"] = [cx, cy]

def draw():
    pyxel.cls(0)

    # Dessine labyrinthe
    for y in range(len(labyrinthe)):
        for x in range(TAILLE_GRILLE):
            if labyrinthe[y][x] == 1:
                pyxel.rect(x * TAILLE_CASE, y * TAILLE_CASE, TAILLE_CASE, TAILLE_CASE, 5)
            elif labyrinthe[y][x] == 2:
                pyxel.rect(x * TAILLE_CASE, y * TAILLE_CASE, TAILLE_CASE, TAILLE_CASE, 11)  # vert clair (objectif)

    # Dessine le carré
    x, y = snake["position_pixel"]
    pyxel.rect(x, y, TAILLE_CASE, TAILLE_CASE, 10)  # jaune

pyxel.run(update, draw)

